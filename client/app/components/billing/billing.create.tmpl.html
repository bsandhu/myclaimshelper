<div class="panel panel-default" id="billPanel">

<div class="panel-heading" style="background-color: #FAFAFA">
    <a href="javascript:void(0);" class="btn-labeled btn-link"
       data-bind="click: routeToBillingOverview">
            <span class="btn-label">
                <i class="glyphicon glyphicon-chevron-left"></i></span>Back to Billing Overview
    </a>

    <div class="pull-right">
        <i class="fa fa-print" style="cursor: pointer"
           data-bind="click: printBill"> Print</i>
    </div>
</div>

<div class="panel-body">

<!--- Header messages -->
<div data-bind="if: isNewBill() && !haveBillableTasks()" class="row">
    <div class="col-sm-12">
        <div class="well well-sm bg-color-greenLighter txt-color-green text-center">
            There are are no Tasks which can be billed at this time.
            Once you add some Tasks you will be able to create a bill for them.
        </div>
    </div>
</div>

<div data-bind="if: haveBillableTasks">
    <div data-bind="if: isBillEditable" class="row" id="bililngCreateMsg">
        <div class="col-sm-12">
            <div class="well well-sm bg-color-greenLighter txt-color-green text-center">
                Please review the tasks to include in the bill
            </div>
        </div>
    </div>
    <div data-bind="ifnot: isBillEditable" class="row">
        <div class="col-sm-12">
            <div class="well well-sm bg-color-greenLighter txt-color-green text-center">
                <i class="fa fa-check-circle"></i>
                <span data-bind="if: isBillSubmitted">
                    <strong>Invoice submitted.</strong> Sent on <span
                        data-bind="text: DateUtils.niceDate(bill().submissionDate())"></span>
                </span>
                <span data-bind="if: isBillPaid">
                    <strong>Invoice Paid.</strong>
                        <span data-bind="text: DateUtils.niceDate(bill().paidDate())"></span>
                </span>
            </div>
        </div>
    </div>
</div>

<!--- Invoice content -->
<div data-bind="if: haveBillableTasks" id="invoice-body" class="yes-print">
    <div class="pull-left">
        <address>
            <br>
            <strong>SmartAdmin, Inc.</strong>
            <br>
            231 Ajax Rd,
            <br>
            Detroit MI - 48212, USA
            <br>
            <abbr title="Phone">P:</abbr> (123) 456-7890
        </address>
    </div>

    <div class="pull-right">
        <h1>Invoice</h1>
    </div>
    <div class="clearfix"></div>
    <br>

    <div class="row">
        <div class="col-sm-8" data-bind="if: isBillEditable">
            <contact-component params="contact : billRecipient,
                                       idSuffix: 'billing-recipient',
                                       allowEdits: false,
                                       showDetails: true,
                                       placeholder: 'Start typing recipient',
                                       isBusinessOptionApplicable: false"></contact-component>
        </div>
        <div class="col-sm-8" data-bind="ifnot: isBillEditable">
            <span data-bind="text: billRecipient().name"></span><br>
            <span data-bind="text: billRecipient().streetAddress"></span><br>
            <span data-bind="text: billRecipient().city"></span>
            <span data-bind="text: billRecipient().zip"></span><br>
            <span data-bind="text: billRecipient().phone"></span>
        </div>
        <div class="col-sm-4 pull-right">
            <div>
                Invoice Number :
                <span class="pull-right" data-bind="text: bill()._id"></span>
            </div>
            <div>
                <h5>Invoice Date :
                    <span class="pull-right"
                          data-bind="text: DateUtils.niceLocaleDate(bill().submissionDate(), 'Not submitted')">
                        <i class="fa fa-calendar"></i>
                    </span>
                </h5>
            </div>
            <br>

            <div class="well well-sm  bg-color-darken txt-color-white no-border">
                <div class="fa-lg">
                    Total Due :
                    <span class="pull-right" data-bind="text: NumberUtils.niceCCY(bill().total()) + ' **'"></span>
                </div>

            </div>
            <br>
        </div>
    </div>
    <!-- **** Entries listing **** -->
    <div class="row">
        <table class="table table-hover" data-bind="sortable" id="billingCreateTable" data-sortable>
            <thead>
            <tr>
                <th data-sortable="true" data-sorted="true" data-sorted-direction="ascending">DATE</th>
                <th>Task</th>
                <th>Description</th>
                <th>Time|Code</th>
                <th>Mileage|Code</th>
                <th>Expense|Code</th>
                <th>Amount</th>
                <th data-bind="if: isBillEditable">&nbsp;</th>
            </tr>
            </thead>
            <tbody>
            <!-- ko foreach: { data: bill().billingItems(), as: 'billingItem' } -->
            <tr>
                <td data-bind="text: $parent.DateUtils.niceLocaleDate(billingItem.entryDate())"></td>
                <td>
                    <i data-bind="taskEntryTag: billingItem.tag()"></i>
                </td>
                <td><a data-bind="text: billingItem.summary,
                                  attr: {href: '#/claimEntry/' + $parent.claimId + '/' + billingItem.claimEntryId()}"></a>
                </td>
                <td>
                    <div style="min-width: 43px" class="inline">
                        <span data-bind="ifnot: $parent.isBillEditable">
                             <span data-bind="text: billingItem.time"></span>
                        </span>
                        <a><span data-bind="if: $parent.isBillEditable">
                            <span data-bind="editable: billingItem.time,
                                             editableOptions: {mode: 'popup',
                                                               title: 'Edit time',
                                                               success: $parent.onTimeUpdate.bind($parent, billingItem)}"></span>
                        </span></a>
                    </div>
                    <span data-bind="text: billingItem.timeCode"></span>
                </td>
                <td>
                    <div style="min-width: 43px" class="inline">
                        <span data-bind="ifnot: $parent.isBillEditable">
                            <span data-bind="text: billingItem.mileage"></span>
                        </span>
                        <a><span data-bind="if: $parent.isBillEditable">
                            <span data-bind="editable: billingItem.mileage,
                                             editableOptions: {mode: 'popup',
                                                             title: 'Edit Mileage',
                                                             success: $parent.onMileageUpdate.bind($parent, billingItem)}"></span>
                        </span></a>
                    </div>
                    <span data-bind="text: billingItem.mileageCode"></span>
                </td>
                <td>
                    <div style="min-width: 63px" class="inline">
                        <span data-bind="ifnot: $parent.isBillEditable">
                            <span data-bind="text: $parent.NumberUtils.niceCCY(billingItem.expenseAmount())"></span>
                        </span>
                        <a><span data-bind="if: $parent.isBillEditable">
                            <span data-bind="editable: billingItem.expenseAmount,
                                             editableOptions: {mode: 'popup',
                                                               title: 'Edit Amount',
                                                               success: $parent.onExpenseAmountUpdate.bind($parent, billingItem)}"></span>
                        </span></a>
                    </div>
                    <span data-bind="text: billingItem.expenseCode"></span>
                </td>
                <td data-bind="text: $parent.NumberUtils.niceCCY(billingItem.totalAmount())"></td>
                <td>
                    <span data-bind="if: $parent.isBillEditable">
                        <a data-toggle="tooltip" data-placement="top" title="Exclude item from this Bill"
                           data-bind="click: $parent.removeBillingItem,
                                      text: billingItem.removeOrUndoLabel ? billingItem.removeOrUndoLabel() : ''">
                        </a>
                    </span>
                </td>
            </tr>
            <!-- /ko -->
            <tr>
                <td colspan="3"><strong>Sub-total</strong></td>
                <td><strong data-bind="text: bill().totalTime() + ' Hrs'"></strong></td>
                <td><strong data-bind="text: bill().totalMileage() + ' Miles'"></strong></td>
                <td><strong data-bind="text: NumberUtils.niceCCY(bill().totalExpenseAmount())"></strong></td>
            </tr>
            </tbody>
        </table>
    </div>
    <!-- **** End entries listing **** -->

    <!-- Totals -->
    <div class="invoice-footer padding-10 row">
        <div class="col-lg-3 col-md-3 col-sm-4 col-xs-8 pull-right">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <div>
                    <div class="inline" style="min-width: 100px">Pre-tax Total</div>
                    <div class="pull-right inline"><strong
                            data-bind="text: NumberUtils.niceCCY(bill().preTaxTotal())"></strong></div>
                </div>
                <div>
                    <div class="inline" style="min-width: 100px"
                         data-bind="text: 'Tax (' + bill().taxRate() + ')%'"></div>
                    <div class="pull-right inline"><strong data-bind="text: NumberUtils.niceCCY(bill().tax())"></strong>
                    </div>
                </div>
                <div>
                    <div class="inline" style="min-width: 100px">
                        <h3><strong>Total</strong></h3>
                    </div>
                    <div class="pull-right inline">
                        <strong><h3>
                            <span class="text-success" data-bind="text: NumberUtils.niceCCY(bill().total())"></span>
                        </h3></strong>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Buttons -->
    <div class="row" data-bind="if: isBillEditable">
        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
            <div class="pull-right">
                <a href="javascript:void(0);" class="btn btn-labeled btn-info"
                   data-bind="click: updateBill">
                    <span class="btn-label"><i class="glyphicon glyphicon-ok"></i></span>Save draft
                </a>
                <a href="javascript:void(0);" class="btn btn-labeled btn-success" data-bind="click: submitBill">
                    <span class="btn-label"><i class="glyphicon glyphicon-arrow-right"></i></span>Submit Bill
                </a>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-sm-12">
            <p class="note">** None</p>
        </div>
    </div>
    <!-- **** End footer **** -->
</div>

</div>
</div>

<!-- Print tmpl is dynamically populated by the VM -->
<script type="text/html" id="print-template"></script>