<div class="panel panel-default">
<div class="panel-heading">
    <div data-bind="text: 'Claim ' + (claim().insuranceCompanyFileNum() || '')"></div>
</div>

<div class="panel-body">
<!-- ************************************************ -->
<!-- Claim static display -->
<!-- ************************************************ -->

<div data-bind="ifnot: inEditMode">
    <div class="bottomMargin">
        <div class="inline rightMargin">
                    <span>
                        <span><strong>Date received:</strong></span>
                        <span data-bind="text: DateUtils.niceDate(claim().dateReceived ? claim().dateReceived() : '')"></span>
                    </span>
        </div>
        <div class="inline rightMargin">
            <span><strong>Date due:</strong></span>
            <span data-bind="text: DateUtils.niceDate(claim().dateDue ? claim().dateDue() : '')"></span>
        </div>
        <div class="inline rightMargin">
            <span><strong>Date of loss:</strong></span>
            <span data-bind="text: DateUtils.niceDate(claim().dateOfLoss ? claim().dateOfLoss() : '')"></span>
        </div>
    </div>

    <div class="bottomMargin">
        <div class="inline rightMargin">
            <span><strong>Insured Attorney:</strong></span>
            <span data-bind="text: niceName(claim().insuredAttorneyContact)"></span>
        </div>
        <div class="inline rightMargin">
            <span><strong>Insured contact:</strong></span>
            <span data-bind="text: niceName(claim().insuredContact) "></span>
        </div>
    </div>

    <div class="bottomMargin">
        <div class="inline rightMargin">
            <span><strong>Claimant attorney:</strong></span>
            <span data-bind="text: niceName(claim().claimantsAttorneyContact)"></span>
        </div>
        <div class="inline rightMargin">
            <span><strong>Claimant contact:</strong></span>
            <span data-bind="text: niceName(claim().claimantContact) "></span>
        </div>
    </div>

    <div class="alignRight rightMargin">
        <span class="glyphicon glyphicon-pencil"></span>
        <span class="leftMargin"><a href="#" data-bind="click: onEditModeClick.bind($data)">Edit</a></span>
    </div>
</div>


<!-- ************************************************ -->
<!-- Claim entry form -->
<!-- ************************************************ -->

<div data-bind="if: inEditMode">
    <div><h5>Insurance Company</h5></div>

    <div class="inline bottomMargin">
        <div class="inline">
            <div class="inline narrow fieldLabel">Name</div>
            <div class="inline wider">
                <input type="text" class="form-control input-sm"
                       data-bind="value: claim().insuranceCompanyName"
                       autocomplete="on">
            </div>
            <div class="inline narrow fieldLabel">File num.</div>
            <div class="inline narrow">
                <input type="text" class="form-control input-sm"
                       data-bind="value: claim().insuranceCompanyFileNum">
            </div>
        </div>
    </div>

    <div class="bottomMargin">
        <div class="inline">
            <div class="inline narrow fieldLabel">Date Received</div>
            <div class="inline normal">
                <input type="text" class="form-control input-sm"
                       data-bind="datetimePicker: {
                                          datepicker: true,
                                          timepicker: true,
                                          dateValue: claim().dateReceived}"/>
            </div>
        </div>
        <div class="inline">
            <div class="inline narrow fieldLabel">Date Due</div>
            <div class="inline normal">
                <input type="text" class="form-control input-sm"
                       data-bind="datetimePicker: {
                                          datepicker: true,
                                          timepicker: true,
                                          dateValue: claim().dateDue}"/>
            </div>
        </div>
        <div class="inline">
            <div class="inline narrow fieldLabel">Date of Loss</div>
            <div class="inline normal">
                <input type="text" class="form-control input-sm"
                       data-bind="datetimePicker: {
                                          datepicker: true,
                                          timepicker: true,
                                          dateValue: claim().dateOfLoss}"/>
            </div>
        </div>
    </div>

    <!-- **** Insured **** -->
    <div class="topBorderSolid"><h5>Insured</h5></div>

    <div class="bottomMargin">
        <div class="narrow fieldLabel tableCell" style="display: table-cell">Attorney</div>
        <div style="display: table-cell">
            <contact-component params="contact : claim().insuredAttorneyContact,
                                               idSuffix: 'claim-insuredAttny',
                                                isBusinessOptionApplicable: true"></contact-component>
        </div>
    </div>

    <div class="bottomMargin">
        <div class="narrow fieldLabel tableCell" style="display: table-cell">Contact</div>
        <div style="display: table-cell">
            <contact-component params="contact : claim().insuredContact,
                                               idSuffix: 'claim-insuredContact',
                                               isBusinessOptionApplicable: false"></contact-component>
        </div>
    </div>

    <!-- **** Claimant **** -->
    <div class="topBorderSolid"><h5>Claimant</h5></div>

    <div class="bottomMargin">
        <div class="narrow fieldLabel" style="display: table-cell">Attorney</div>
        <div style="display: table-cell">
            <contact-component params="contact : claim().claimantsAttorneyContact,
                                               idSuffix: 'claim-claimantAttny',
                                               isBusinessOptionApplicable: true"></contact-component>
        </div>
    </div>

    <div class="bottomMargin">
        <div class="narrow fieldLabel" style="display: table-cell">Contact</div>
        <div style="display: table-cell">
            <contact-component params="contact : claim().claimantContact,
                                               idSuffix: 'claim-claimantContact',
                                               isBusinessOptionApplicable: false"></contact-component>
        </div>
    </div>

    <div class="topBorderSolid bottomMargin"></div>

    <div class="topMargin5">
        <div class="narrow fieldLabel" style="display: table-cell">
            Description
        </div>
        <div class="inline" style="display: table-cell; width: 95%; padding-left: 3px">
            <textarea class="form-control" rows="3" id="claimEntry-textArea"
                      data-bind="value: claim().description" placeholder="Note"></textarea>
        </div>
    </div>
    <div class="topMargin"/>

    <!-- **** Edit Button **** -->

    <div class="topMargin5 clear">
        <div class="inline alignRight topMargin5">
            <button type="button" class="btn btn-default" data-bind="click: onSave">Save</button>
            <button type="button" class="btn btn-default" data-bind="click: onCancel">Cancel</button>
        </div>
    </div>
</div>

<!-- ************************************************ -->
<!-- New entry button group -->
<!-- ************************************************ -->

<div data-bind="ifnot: inEditMode">
    <div class="btn-group topMargin1pc">
        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
            <span class="fa fa-plus"></span>
            Add New Entry <span class="caret"></span>
        </button>
        <ul class="dropdown-menu" role="menu">
            <li>
                <a href="#/claimEntry/new/phone">
                    <span class="glyphicon glyphicon-earphone"></span>
                    <span class="leftMargin5">Phone</span>
                </a>
            </li>
            <li>
                <a href="#/claimEntry/new/visit">
                    <span class="glyphicon glyphicon-map-marker"></span>
                    <span class="leftMargin5">Site visit</span>
                </a>
            </li>
            <li>
                <a href="#/claimEntry/new/photos">
                    <span class="glyphicon glyphicon-camera"></span>
                    <span class="leftMargin5">Photos</span>
                </a>
            </li>
            <li class="divider"></li>
            <li>
                <a href="#/claimEntry/new/other">
                    <span class="leftMargin5">Other</span>
                </a>
            </li>
        </ul>
    </div>
</div>

<!-- ************************************************ -->
<!--List Claim Entries -->
<!-- ************************************************ -->

<div data-bind="ifnot: inEditMode" class="rightMargin topMargin5">

    <table style="width: 98%" class="table table-hover table-condensed" id="claimEntriesList">
        <thead>
        <tr>
            <th>&nbsp;</th>
            <th>Tasks</th>
            <th>
                <a href="#" data-bind="click: onSortEntries.bind($data)">
                    Entered on
                            <span data-bind="css: {'glyphicon-sort-by-attributes': sortDir() == 'asc',
                                                   'glyphicon-sort-by-attributes-alt': sortDir() == 'desc'}"
                                  class="glyphicon"></span>
                </a>
            </th>
            <th>Status</th>
        </tr>
        </thead>

        <!-- Claim entry row -->
        <tbody data-bind="foreach: {data: claimEntries, as: 'entry' }">
        <tr data-bind="click: $parent.onClaimEntryClick.bind($parent)">
            <td style="min-width: 15px">
                <!-- Tag -->
                        <span class="glyphicon leftMargin"
                              data-bind="css: {'glyphicon-earphone'   : entry.tag.toString().search('phone') >= 0,
                                               'glyphicon-map-marker' : entry.tag.toString().search('visit') >= 0,
                                               'glyphicon-camera'     : entry.tag.toString().search('photos') >= 0,
                                               'glyphicon-envelope'   : entry.tag.toString().search('email') >= 0}"></span>
            </td>
            <td style="min-width: 20%;">
                <a data-bind="attr: {href: '#/claimEntry/' + entry._id}">
                    <span data-bind="text: entry.summary"></span>
                </a>
            </td>
            <td class="rightMargin">
                <span data-bind="text: $parent.DateUtils.niceDate(entry.entryDate)"></span>
            </td>
            <td>
                <!-- Current state -->
                <a href="#" data-bind="event: { mouseover: $parent.onStatusFocus.bind($parent)}">
                            <span class="glyphicon"
                                  data-bind="css: {'glyphicon-unchecked': entry.state == undefined || entry.state == $parent.States.None,
                                                   'glyphicon-inbox'    : entry.state == $parent.States.TODO,
                                                   'glyphicon-time'     : entry.state == $parent.States.Pending,
                                                   'glyphicon-ok'       : entry.state == $parent.States.Complete}"></span>
                </a>

                <!-- Pick new State -->
                <div style="z-index: 9999; width: 135px; position: fixed" class="list-group"
                     data-bind="visible: $parent.showStatusForEntryId() == entry._id">
                    <a data-bind="click: $parent.onEntryStatusUpdate.bind($parent, $parent.States.TODO)"
                       class="list-group-item" href="#">
                        <span class="glyphicon glyphicon-inbox"></span>
                        <span class="leftMargin">To Do</span>
                    </a>
                    <a data-bind="click: $parent.onEntryStatusUpdate.bind($parent, $parent.States.Complete)"
                       href="#" class="list-group-item">
                        <span class="glyphicon glyphicon-ok"></span>
                        <span class="leftMargin">Complete</span>
                    </a>
                    <a data-bind="click: $parent.onEntryStatusUpdate.bind($parent, $parent.States.Pending)"
                       href="#" class="list-group-item">
                        <span class="glyphicon glyphicon-time"></span>
                        <span class="leftMargin">Pending</span>
                    </a>
                    <a data-bind="click: $parent.onEntryStatusUpdate.bind($parent, $parent.States.None)"
                       href="#" class="list-group-item">
                        <span class="glyphicon glyphicon-unchecked"></span>
                        <span class="leftMargin">Clear</span>
                    </a>
                </div>
            </td>
            <td class=" rightMargin">
                <div class="fa fa-angle-right"></div>
            </td>
        </tr>
        </tbody>

    </table>
</div>

</div>
</div>